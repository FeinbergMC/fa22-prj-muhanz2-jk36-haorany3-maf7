---
title: "Trend Analysis"
author: "Henry Yin"
output:
  pdf_document: default
  html_notebook: default
---
This section follows up on the previous analysis and looks closer into countries that experienced largest change in freedom score and prosperity score. We get raw, continuous data from the World Bank and plot it with year. The purpose is to see trends movement as these countries went through big changes. The countries chosen here are Venezuela, Hungary, China, and USA. 

#### Packages
```{r}
library(WDI)
library(tidyr)
library(dplyr)
library(data.table)
library(ggplot2)
library(ggpubr)
library(lattice)
```

#### Fetch Data (Part 1, Freedom)
```{r}
# Property rights as raw data for economic freedom
property_rights = WDI(indicator = c("IC.PRP.DURS", "IC.PRP.PROC", "GC.TAX.YPKG.ZS"), extra = TRUE)
names(property_rights)[names(property_rights) == "IC.PRP.DURS"] = "register_property_time"
names(property_rights)[names(property_rights) == "IC.PRP.PROC"] = "register_property_procedure"
names(property_rights)[names(property_rights) == "GC.TAX.YPKG.ZS"] = "tax"

# Civil liberties as raw data for political freedom
civil_liberties = WDI(indicator = c("SE.ADT.LITR.ZS", "IQ.CPA.BREG.XQ"), extra = TRUE)
names(civil_liberties)[names(civil_liberties) == "SE.ADT.LITR.ZS"] = "literacy_rate"
names(civil_liberties)[names(civil_liberties) == "IQ.CPA.BREG.XQ"] = "business_regulatory_environment"

#Regulatory effectiveness as raw data for legal freedom
regulatory_effectiveness = WDI(indicator = c("IQ.CPA.PROP.XQ", "IC.LGL.CRED.XQ"), extra = TRUE)
names(regulatory_effectiveness)[names(regulatory_effectiveness) == "IQ.CPA.PROP.XQ"] = "rule_governance_rating"
names(regulatory_effectiveness)[names(regulatory_effectiveness) == "IC.LGL.CRED.XQ"] = "legal_rights"
```

#### Fetch Data (Part 2, Prosperity)
```{r}
# Environment raw data
environment = WDI(indicator = c("EN.ATM.CO2E.PC", "AG.LND.FRST.ZS", "EN.ATM.PM25.MC.M3", "ER.H2O.FWST.ZS"), extra = TRUE)
names(environment)[names(environment) == "EN.ATM.CO2E.PC"] = "co2_emmision"
names(environment)[names(environment) == "AG.LND.FRST.ZS"] = "forest_area"
names(environment)[names(environment) == "EN.ATM.PM25.MC.M3"] = "pm2.5"
names(environment)[names(environment) == "ER.H2O.FWST.ZS"] = "water_stress"

# Income raw data
income = WDI(indicator = c("NY.GNP.PCAP.PP.CD", "FP.CPI.TOTL.ZG", "SL.UEM.TOTL.ZS"), extra = TRUE)
names(income)[names(income) == "NY.GNP.PCAP.PP.CD"] = "gni_capita"
names(income)[names(income) == "FP.CPI.TOTL.ZG"] = "inflation"
names(income)[names(income) == "SL.UEM.TOTL.ZS"] = "unemployment"

# Health raw data
health = WDI(indicator = c("SP.DYN.LE00.IN", "SH.STA.DIAB.ZS"), extra = TRUE)
names(health)[names(health) == "SP.DYN.LE00.IN"] = "life_expectancy"
names(health)[names(health) == "SH.STA.DIAB.ZS"] = "diabetes"
```

### Case Study1: Venezuela
#### Cleaning data
```{r}
# Filter freedom data for Venezuela
Venezuela_econ = property_rights %>% dplyr::filter(country %in% c("Venezuela, RB")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year) %>% mutate(econ_score = (register_property_time + register_property_procedure + tax) / 3)

Venezuela_poli = civil_liberties %>% dplyr::filter(country %in% c("Venezuela, RB")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year) %>% mutate(poli_score = (literacy_rate + business_regulatory_environment) / 2)

Venezuela_legal = regulatory_effectiveness %>% dplyr::filter(country %in% c("Venezuela, RB")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year) %>% mutate(legal_score = (rule_governance_rating + legal_rights) / 2)

# Filter prosperity data for Venezuela
Venezuela_envir = environment %>% dplyr::filter(country %in% c("Venezuela, RB")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year)

Venezuela_income = income %>% dplyr::filter(country %in% c("Venezuela, RB")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year)

Venezuela_health = health %>% dplyr::filter(country %in% c("Venezuela, RB")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year)
```

#### Time series plotting
```{r}
# Freedom
# Economic freedom
plot(register_property_time ~ year, Venezuela_econ, type = "l", col = "red", xlab = "Year", ylab = "Vebezuela Econ", main = "Economic Freedom Trend for Venezuela")
par(new = TRUE)
plot(register_property_procedure ~ year, Venezuela_econ, axes = FALSE, type = "l", col = "blue", xlab = "", ylab = "")
legend("bottomright", lty=c(1,1), col=c("red", "blue"), legend=c("Register Property Time", "Register Property Procedure"))

# Political and legal freedom are ignored as too less data points were collected.

# Prosperity
# Environment
VE = ggplot(Venezuela_envir, aes(x = year)) +
  geom_line(aes(y = co2_emmision, color = "CO2 Emmision")) +
  geom_line(aes(y = forest_area / 10, color = "Forest Area")) +
  geom_line(aes(y = water_stress, color = "Water Stress")) +
  labs(title = "Environment Level Measurement") +
  xlab("Year") +
  ylab("Environment")

# Income
VI = ggplot(Venezuela_income, aes(x = year)) +
  geom_line(aes(y = gni_capita / 1000, color = "GNI per Capita, Current $")) +
  geom_line(aes(y = inflation / 10 , color = "Inflation, Annual %")) +
  geom_line(aes(y = unemployment, color = "Unemployment, % Total")) +
  labs(title = "Income Level Measurement") +
  xlab("Year") +
  ylab("Income")

# Health
VH = ggplot(Venezuela_health, aes(x = year)) +
  geom_line(aes(y = life_expectancy, color = "Life Expectancy")) +
  labs(title = "Health Level Measurement") +
  xlab("Year") +
  ylab("Life Expectancy")

ggarrange(VE, VH, VI)
```

### Case Study2: Hungary
#### Cleaning data
```{r}
# Filter freedom data for Hungary
Hungary_econ = property_rights %>% dplyr::filter(country %in% c("Hungary")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year)

Hungary_poli = civil_liberties %>% dplyr::filter(country %in% c("Hungary")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year)

Hungary_legal = regulatory_effectiveness %>% dplyr::filter(country %in% c("Hungary")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year)

# Filter prosperity data for Hungary
Hungary_envir = environment %>% dplyr::filter(country %in% c("Hungary")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year)

Hungary_income = income %>% dplyr::filter(country %in% c("Hungary")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year)

Hungary_health = health %>% dplyr::filter(country %in% c("Hungary")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year)
```

#### Time series plotting
```{r}
# Freedom
# Economic freedom
plot(register_property_time ~ year, Hungary_econ, type = "l", col = "red", xlab = "Year", ylab = "Hungary Econ", main = "Economic Freedom Trend for Hungary")
par(new = TRUE)
plot(tax ~ year, Hungary_econ, axes = FALSE, type = "l", col = "blue", xlab = "", ylab = "")
legend("bottomright", lty=c(1,1), col=c("red", "blue"), legend=c("Register Property Time", "Tax"))

# Political and legal freedom are ignored as too less data points were collected.

# Prosperity
# Environment
HE = ggplot(Hungary_envir, aes(x = year)) +
  geom_line(aes(y = co2_emmision * 2, color = "CO2 Emmision")) +
  geom_line(aes(y = forest_area / 2, color = "Forest Area")) +
  geom_line(aes(y = water_stress, color = "Water Stress")) +
  labs(title = "Environment Level Measurement") +
  xlab("Year") +
  ylab("Environment")

# Income
HI = ggplot(Hungary_income, aes(x = year)) +
  geom_line(aes(y = gni_capita / 2000, color = "GNI per Capita, Current $")) +
  geom_line(aes(y = inflation, color = "Inflation, Annual %")) +
  geom_line(aes(y = unemployment / 2, color = "Unemployment, % Total")) +
  labs(title = "Income Level Measurement") +
  xlab("Year") +
  ylab("Income")

# Health
HH = ggplot(Hungary_health, aes(x = year)) +
  geom_line(aes(y = life_expectancy, color = "Life Expectancy")) +
  labs(title = "Health Level Measurement") +
  xlab("Year") +
  ylab("Life Expectancy")

ggarrange(HE, HH, HI)
```

### Case Study3: Europe Union
#### Cleaning data
```{r}
# Filter freedom data for EU
EU_econ = property_rights %>% dplyr::filter(country %in% c("European Union")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year)

EU_poli = civil_liberties %>% dplyr::filter(country %in% c("European Union")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year)

EU_legal = regulatory_effectiveness %>% dplyr::filter(country %in% c("European Union")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year)

# Filter prosperity data for EU
EU_envir = environment %>% dplyr::filter(country %in% c("European Union")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year)

EU_income = income %>% dplyr::filter(country %in% c("European Union")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year)

EU_health = health %>% dplyr::filter(country %in% c("European Union")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year)
```

#### Time series plotting
```{r}
# Freedom
# Economic freedom
plot(register_property_time ~ year, EU_econ, type = "l", col = "red", xlab = "Year", ylab = "EU Econ", main = "Economic Freedom Trend for EU")
par(new = TRUE)
plot(register_property_procedure ~ year, EU_econ, axes = FALSE, type = "l", col = "blue", xlab = "", ylab = "")
legend("bottomright", lty=c(1,1), col=c("red", "blue"), legend=c("Register Property Time", "Register Property Procedure"))

# Political and legal freedom are ignored as too less data points were collected.

# Prosperity
# Environment
EE = ggplot(EU_envir, aes(x = year)) +
  geom_line(aes(y = co2_emmision, color = "CO2 Emmision")) +
  geom_line(aes(y = forest_area / 5, color = "Forest Area")) +
  geom_line(aes(y = pm2.5 / 2, color = "PM2.5 Air Pollution")) +
  labs(title = "Environment Level Measurement") +
  xlab("Year") +
  ylab("Environment")

# Income
EI = ggplot(EU_income, aes(x = year)) +
  geom_line(aes(y = gni_capita / 2000, color = "GNI per Capita, Current $")) +
  geom_line(aes(y = inflation, color = "Inflation, Annual %")) +
  geom_line(aes(y = unemployment / 2, color = "Unemployment, % Total")) +
  labs(title = "Income Level Measurement") +
  xlab("Year") +
  ylab("Income")

# Health
EH = ggplot(EU_health, aes(x = year)) +
  geom_line(aes(y = life_expectancy, color = "Life Expectancy")) +
  labs(title = "Health Level Measurement") +
  xlab("Year") +
  ylab("Life Expectancy")

ggarrange(EE, EH, EI)
```

### Case Study4: United States
#### Cleaning data
```{r}
# Filter freedom data for US
US_econ = property_rights %>% dplyr::filter(country %in% c("United States")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year)

US_poli = civil_liberties %>% dplyr::filter(country %in% c("United States")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year)

US_legal = regulatory_effectiveness %>% dplyr::filter(country %in% c("United States")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year)

# Filter prosperity data for US
US_envir = environment %>% dplyr::filter(country %in% c("United States")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year)

US_income = income %>% dplyr::filter(country %in% c("United States")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year)

US_health = health %>% dplyr::filter(country %in% c("United States")) %>% select(-iso2c, -iso3c, -status, -lastupdated, -region, -longitude, -latitude, -capital, -income, -lending) %>% filter(year >= 2005) %>% arrange(year)
```

#### Time series plotting
```{r}
# Freedom
# Economic freedom
plot(register_property_time ~ year, EU_econ, type = "l", col = "red", xlab = "Year", ylab = "US Econ", main = "Economic Freedom Trend for US")
par(new = TRUE)
plot(tax ~ year, US_econ, axes = FALSE, type = "l", col = "blue", xlab = "", ylab = "")
legend("bottomright", lty=c(1,1), col=c("red", "blue"), legend=c("Register Property Time", "Tax"))

# Political and legal freedom are ignored as too less data points were collected.

# Prosperity
# Environment
USE = ggplot(US_envir, aes(x = year)) +
  geom_line(aes(y = co2_emmision, color = "CO2 Emmision")) +
  geom_line(aes(y = forest_area / 2, color = "Forest Area")) +
  geom_line(aes(y = water_stress / 1.5, color = "Water Stress")) +
  labs(title = "Environment Level Measurement") +
  xlab("Year") +
  ylab("Environment")

# Income
USI = ggplot(US_income, aes(x = year)) +
  geom_line(aes(y = gni_capita / 4000, color = "GNI per Capita, Current $")) +
  geom_line(aes(y = inflation, color = "Inflation, Annual %")) +
  geom_line(aes(y = unemployment, color = "Unemployment, % Total")) +
  labs(title = "Income Level Measurement") +
  xlab("Year") +
  ylab("Income")

# Health
USH = ggplot(US_health, aes(x = year)) +
  geom_line(aes(y = life_expectancy, color = "Life Expectancy")) +
  labs(title = "Health Level Measurement") +
  xlab("Year") +
  ylab("Life Expectancy")

ggarrange(USE, USH, USI)
```
